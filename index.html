<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Flappy Bird: Legendary Boss Edition</title>
    <style>
        body { 
            margin: 0; 
            background: linear-gradient(135deg, #0c0c0c, #1a1a2e); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            overflow: hidden; 
            font-family: 'Arial Black', sans-serif; 
            user-select: none;
        }
        canvas { 
            border: 4px solid #333; 
            border-radius: 20px; 
            box-shadow: 0 0 50px rgba(255,215,0,0.3), inset 0 0 50px rgba(0,0,0,0.5); 
            image-rendering: pixelated; 
            cursor: pointer;
            transition: box-shadow 0.3s;
        }
        canvas:hover { box-shadow: 0 0 80px rgba(255,215,0,0.5), inset 0 0 50px rgba(0,0,0,0.5); }
        #ui { 
            position: absolute; 
            top: 0; left: 0; width: 100%; height: 100%; 
            pointer-events: none; 
            color: #fff; 
            text-align: center; 
            text-shadow: 0 0 10px rgba(255,255,255,0.8);
        }
        #ui h1 { font-size: 48px; margin: 80px 0 0; letter-spacing: 4px; animation: glow 2s ease-in-out infinite alternate; }
        @keyframes glow { from { text-shadow: 0 0 20px #fff; } to { text-shadow: 0 0 30px #ffd700, 0 0 40px #ffd700; } }
        #ui p { font-size: 28px; margin: 15px 0; opacity: 0.9; animation: pulse 1.5s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { opacity: 0.9; } 50% { opacity: 1; } }
        .medal { font-size: 24px; margin: 10px; padding: 8px 16px; border-radius: 20px; display: inline-block; }
        .bronze { background: linear-gradient(45deg, #cd7f32, #b8860b); }
        .silver { background: linear-gradient(45deg, #c0c0c0, #a9a9a9); }
        .gold { background: linear-gradient(45deg, #ffd700, #ffed4e); }
        .plat { background: linear-gradient(45deg, #e5e4e2, #b9f2ff); box-shadow: 0 0 20px #00bfff; }
    </style>
</head>
<body>
    <canvas id="game"></canvas>
    <div id="ui">
        <h1>ü¶Ö LEGENDARY BOSS EDITION ü¶Ö</h1>
        <p id="startText">DOKUN / TIKLA / BO≈ûLUK ile BA≈ûLA</p>
        <p id="highScoreText" style="font-size: 32px;"></p>
        <div id="medal" style="display:none;"></div>
        <p id="gameOverText" style="display:none; font-size:42px; margin-top:200px;">
            üíÄ OYUN Bƒ∞TTƒ∞ üíÄ<br>
            <span style="font-size:26px; opacity:0.8;">YENƒ∞DEN BA≈ûLA</span>
        </p>
    </div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = 380; canvas.height = 680;

let frames = 0, score = 0, highScore = parseInt(localStorage.getItem("flappyBossHigh") || "0");
let gameState = "START", flash = 0, shake = 0, slowMo = 0;
let pipes = [], particles = [], gameSpeed = 2.5, bgOffset = 0, groundOffset = 0;
let audioCtx = null;

document.getElementById("highScoreText").innerText = `üèÜ EN Y√úKSEK: ${highScore}`;

function initAudio() {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
}
initAudio();

// Web Audio SFX (Tamamen internal - external dosya yok!)
function playSFX(type) {
    if (!audioCtx) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.connect(gain);
    gain.connect(audioCtx.destination);

    switch(type) {
        case "wing":
            osc.frequency.setValueAtTime(800, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.05);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15);
            break;
        case "point":
            osc.frequency.setValueAtTime(1200, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(600, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.4, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15);
            break;
        case "hit":
            osc.frequency.setValueAtTime(200, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.2);
            gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            break;
        case "die":
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.5);
            gain.gain.setValueAtTime(0.4, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.6);
            break;
    }
    osc.type = "sine";
    osc.start(audioCtx.currentTime);
    osc.stop(audioCtx.currentTime + 0.3);
}

const bird = {
    x: 90, y: 320, w: 38, h: 28, vel: 0, gravity: 0.3, jump: -6.2, rot: 0, animFrame: 0,
    draw() {
        ctx.save();
        ctx.translate(this.x + this.w/2, this.y + this.h/2);
        ctx.rotate(this.rot);

        // Geli≈ümi≈ü squash & stretch + kanat animasyonu
        let squash = Math.abs(this.vel) * 0.025;
        let wingFlap = Math.sin(frames * 0.3 + this.animFrame * Math.PI) * 0.6;
        if (this.vel > 0.5) wingFlap = Math.sin(frames * 0.15) * 0.3; // D√º≈ü√º≈üte yava≈ü

        ctx.scale(1 + squash * 0.5, 1 - squash);

        // Ku≈ü g√∂vde (gradient)
        let gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, 20);
        let color = (score >= 35) ? "#ff4757" : "#feca57";
        gradient.addColorStop(0, color); gradient.addColorStop(1, color + "88");
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.ellipse(0, 0, 19, 15, 0, 0, Math.PI*2);
        ctx.fill();
        ctx.strokeStyle = "#000"; ctx.lineWidth = 2.8; ctx.stroke();

        // Kanatlar
        ctx.fillStyle = color + "cc";
        ctx.beginPath();
        ctx.ellipse(-8, wingFlap * 4 - 2, 12, 6, wingFlap * 0.3, 0, Math.PI*2);
        ctx.fill();
        ctx.stroke();

        // G√∂z (parlama efekti)
        let eyeGrad = ctx.createRadialGradient(10, -5, 0, 10, -5, 7);
        eyeGrad.addColorStop(0, "#fff"); eyeGrad.addColorStop(0.6, "#ffeb3b"); eyeGrad.addColorStop(1, "#333");
        ctx.fillStyle = eyeGrad;
        ctx.beginPath(); ctx.arc(10, -5, 6.5, 0, Math.PI*2); ctx.fill();
        ctx.stroke();

        // Gaga (3D hissi)
        let beakGrad = ctx.createLinearGradient(15, -2, 28, 4);
        beakGrad.addColorStop(0, "#ffaa00"); beakGrad.addColorStop(1, "#cc8800");
        ctx.fillStyle = beakGrad;
        ctx.beginPath();
        ctx.moveTo(16, -1); ctx.lineTo(29, 4 + wingFlap); ctx.lineTo(16, 9); ctx.lineTo(20, 4);
        ctx.fill();
        ctx.stroke();

        ctx.restore();
    },
    update() {
        if(gameState === "START") { 
            this.y = 320 + Math.sin(frames*0.07)*20; 
            this.animFrame += 0.1;
            this.rot = Math.sin(frames*0.1) * 0.1;
            return; 
        }
        this.vel += this.gravity;
        this.y += this.vel * (1 - slowMo * 0.4);
        this.rot = Math.min(Math.PI/2.8, Math.max(-Math.PI/4, this.vel * 0.15));
        this.animFrame += 0.2;

        if(this.y + this.h >= canvas.height - 90 || this.y <= -30) die();
    }
};

function createParticles(x, y, color, count = 15) {
    for(let i = 0; i < count; i++) {
        particles.push({
            x, y, vx: (Math.random() - 0.5) * 12, vy: (Math.random() - 0.5) * 12,
            life: 1, decay: Math.random() * 0.04 + 0.02, size: Math.random() * 4 + 2, color
        });
    }
}

function die() {
    if(gameState === "OVER") return;
    gameState = "OVER";
    shake = 35;
    flash = 0.9;
    slowMo = 0.8;
    playSFX("hit");
    setTimeout(() => playSFX("die"), 150);
    createParticles(bird.x + bird.w/2, bird.y + bird.h/2, "#ff4757", 30);

    if(score > highScore) {
        highScore = score;
        localStorage.setItem("flappyBossHigh", highScore);
        document.getElementById("highScoreText").innerText = `üèÜ EN Y√úKSEK: ${highScore} ‚ú®YENƒ∞ REKOR!‚ú®`;
    }
    updateMedal();
    document.getElementById("gameOverText").style.display = "block";
}

function updateMedal() {
    const medalEl = document.getElementById("medal");
    medalEl.style.display = "block";
    if(score >= 50) medalEl.innerHTML = '<span class="medal plat">üèÜ PLATƒ∞N</span>';
    else if(score >= 35) medalEl.innerHTML = '<span class="medal gold">ü•á ALTIN</span>';
    else if(score >= 25) medalEl.innerHTML = '<span class="medal silver">ü•à G√úM√ú≈û</span>';
    else if(score >= 15) medalEl.innerHTML = '<span class="medal bronze">ü•â BRONZ</span>';
}

function loop() {
    ctx.save();

    // Shake + SlowMo
    if(shake > 0) {
        ctx.translate((Math.random()-0.5)*shake, (Math.random()-0.5)*shake);
        shake *= 0.88;
    }
    if(slowMo > 0) slowMo *= 0.92;

    // Parallax Arka Plan (3 katman)
    bgOffset -= gameSpeed * 0.3;
    let skyHue = (score >= 35) ? 5 : 195;
    let skyGrad = ctx.createLinearGradient(0, 0, 0, canvas.height);
    skyGrad.addColorStop(0, `hsl(${skyHue}, 50%, 70%)`);
    skyGrad.addColorStop(0.5, `hsl(${skyHue}, 40%, 50%)`);
    skyGrad.addColorStop(1, `hsl(${skyHue}, 30%, 20%)`);
    ctx.fillStyle = skyGrad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Bulutlar (parallax)
    ctx.fillStyle = "rgba(255,255,255,0.8)";
    for(let i = 0; i < 5; i++) {
        let cloudX = (bgOffset * (0.5 + i*0.1) + i*200) % (canvas.width + 100);
        ctx.beginPath();
        ctx.arc(cloudX, 120 + i*40, 30, 0, Math.PI*2);
        ctx.arc(cloudX+35, 120 + i*40, 40, 0, Math.PI*2);
        ctx.arc(cloudX+70, 120 + i*40, 30, 0, Math.PI*2);
        ctx.fill();
    }

    // Borular (geli≈ümi≈ü)
    if(gameState === "PLAYING" && frames % 88 === 0) {
        let gap = Math.max(110, 150 - score * 1.3);
        let pY = -Math.random() * 250 - 60;
        pipes.push({
            x: canvas.width + 40, 
            y: pY, 
            gap, 
            seed: Math.random()*8, 
            passed: false, 
            moveAmp: Math.min(score / 20, 1.2),
            width: 72
        });
    }

    pipes.forEach((p, i) => {
        p.x -= gameSpeed;
        let move = p.moveAmp * Math.sin(frames * 0.05 + p.seed) * 40;

        // Boru gradient + parlama
        let pipeGrad = ctx.createLinearGradient(p.x, 0, p.x + p.width, 0);
        let pipeColor = (score >= 35) ? "#2d0000" : "#4a8c2e";
        pipeGrad.addColorStop(0, pipeColor); pipeGrad.addColorStop(1, pipeColor + "aa");

        ctx.fillStyle = pipeGrad;
        ctx.strokeStyle = "#000"; ctx.lineWidth = 5;
        ctx.shadowColor = "#fff"; ctx.shadowBlur = 8;

        // √úst boru
        ctx.fillRect(p.x, p.y + move, p.width, 480);
        ctx.strokeRect(p.x, p.y + move, p.width, 480);

        // Alt boru
        ctx.fillRect(p.x, p.y + move + 480 + p.gap, p.width, 700);
        ctx.strokeRect(p.x, p.y + move + 480 + p.gap, p.width, 700);

        ctx.shadowBlur = 0;

        // √áarpƒ±≈üma (daha hassas)
        if(bird.x + bird.w*0.7 > p.x && bird.x + bird.w*0.3 < p.x + p.width) {
            if(bird.y + bird.h*0.3 < p.y + move + 480 || bird.y + bird.h*0.7 > p.y + move + 480 + p.gap) die();
        }

        if(!p.passed && p.x + p.width < bird.x) { 
            score++; 
            p.passed = true;
            playSFX("point");
            createParticles(p.x + p.width/2, canvas.height/2, "#ffd700", 12);
            gameSpeed = Math.min(5.8, gameSpeed + 0.038);
            if(score % 10 === 0) { 
                shake = 22; 
                slowMo = 0.7;
                createParticles(canvas.width/2, canvas.height/2, "#00ff88", 25);
            }
        }

        if(p.x < -100) pipes.splice(i, 1);
    });

    // Particles
    particles.forEach((p, i) => {
        p.x += p.vx; p.y += p.vy; p.vy += 0.2; p.life -= p.decay;
        ctx.save(); ctx.globalAlpha = p.life; ctx.fillStyle = p.color;
        ctx.beginPath(); ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI*2); ctx.fill(); ctx.restore();
        if(p.life <= 0) particles.splice(i, 1);
    });

    bird.update(); bird.draw();

    // Vignette + God Rays (hard mode)
    if(score >= 35) {
        let grad = ctx.createRadialGradient(bird.x+19, bird.y+14, 50, bird.x+19, bird.y+14, 350);
        grad.addColorStop(0, "rgba(0,0,0,0)"); 
        grad.addColorStop(0.6, "rgba(0,0,0,0.5)"); 
        grad.addColorStop(1, "rgba(0,0,0,0.98)");
        ctx.fillStyle = grad; 
        ctx.fillRect(0,0,canvas.width,canvas.height);
    }

    // Animasyonlu Zemin (parallax + √ßakƒ±l)
    groundOffset -= gameSpeed * 1.5;
    ctx.fillStyle = "#d4b88a";
    ctx.fillRect(0, canvas.height-90, canvas.width, 90);
    ctx.fillStyle = "#b8975e";
    for(let i = 0; i < 20; i++) {
        let gx = (groundOffset + i*25) % canvas.width;
        ctx.fillRect(gx, canvas.height-90, 30, 90);
    }
    ctx.fillStyle = "#a67c4d";
    ctx.fillRect(0, canvas.height-20, canvas.width, 20); // √áizgi

    // Skor (glow efekt)
    ctx.textAlign = "center"; 
    ctx.shadowColor = "#ffd700"; ctx.shadowBlur = 15;
    ctx.fillStyle = "#fff"; 
    ctx.strokeStyle = "#000"; ctx.lineWidth = 10;
    ctx.font = "bold 80px Impact";
    ctx.strokeText(score, canvas.width/2, 130); 
    ctx.fillText(score, canvas.width/2, 130);
    ctx.shadowBlur = 0;

    ctx.restore();

    if(flash > 0) {
        ctx.fillStyle = `rgba(255,255,255,${flash})`;
        ctx.fillRect(0,0,canvas.width,canvas.height);
        flash -= 0.09;
    }

    frames++;
    requestAnimationFrame(loop);
}

const input = (e) => {
    if(e.type === "touchstart" || e.type === "mousedown") e.preventDefault();
    if(gameState === "START") {
        gameState = "PLAYING";
        document.getElementById("startText").style.display = "none";
        document.getElementById("title").style.display = "none"; // h1 id="title" yok ama ui gizle
        document.querySelector("#ui").style.opacity = "0";
        setTimeout(() => document.querySelector("#ui").style.display = "none", 500);
    } else if(gameState === "PLAYING") {
        bird.vel = bird.jump;
        playSFX("wing");
        createParticles(bird.x + bird.w/2, bird.y + bird.h/2, "#feca57", 8);
    } else if(gameState === "OVER" && flash <= 0) {
        // Reset
        pipes = []; particles = []; score = 0; bird.y = 320; bird.vel = 0; bird.rot = 0;
        gameSpeed = 2.5; shake = 0; flash = 0; slowMo = 0; gameState = "START";
        document.getElementById("gameOverText").style.display = "none";
        document.querySelector("#ui").style.display = "block";
        document.querySelector("#ui").style.opacity = "1";
        document.getElementById("medal").style.display = "none";
        updateMedal();
    }
};

// Events (mobil + desktop)
canvas.addEventListener("touchstart", input);
canvas.addEventListener("mousedown", input);
window.addEventListener("keydown", (e) => { if(e.code === "Space") { e.preventDefault(); input(e); } });

// Audio resume on user gesture
document.body.addEventListener("click", () => audioCtx?.resume(), {once: true});
document.body.addEventListener("touchstart", () => audioCtx?.resume(), {once: true});

loop();
</script>
</body>
</html>
