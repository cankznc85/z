<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Flappy Bird: Legendary Boss Edition</title>
    <style>
        body { margin: 0; background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: 'Arial Black', sans-serif; }
        canvas { border: 4px solid #444; border-radius: 15px; box-shadow: 0 0 100px rgba(255, 255, 255, 0.1); }
    </style>
</head>
<body>
    <canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = 360; canvas.height = 640;

let frames = 0, score = 0, gameState = "START", flash = 0, shake = 0;
let pipes = [], particles = [], gameSpeed = 2.8;

const bird = {
    x: 60, y: 300, w: 34, h: 24, vel: 0, gravity: 0.26, jump: 5.6, rot: 0,
    draw() {
        ctx.save();
        ctx.translate(this.x + this.w/2, this.y + this.h/2);
        ctx.rotate(this.rot);
        
        // Squash & Stretch
        let s = Math.abs(this.vel) * 0.02;
        ctx.scale(1 + s, 1 - s);

        ctx.fillStyle = (score >= 25) ? "#ff0000" : "#f7d302"; // Hard mode'da kuş kırmızı olur
        ctx.beginPath(); ctx.ellipse(0, 0, 18, 14, 0, 0, Math.PI*2); ctx.fill();
        ctx.strokeStyle = "black"; ctx.lineWidth = 2; ctx.stroke();
        
        // Göz ve Gaga
        ctx.fillStyle = "white"; ctx.beginPath(); ctx.arc(8, -5, 5, 0, Math.PI*2); ctx.fill(); ctx.stroke();
        ctx.fillStyle = "#f75302"; ctx.beginPath(); ctx.moveTo(12, 0); ctx.lineTo(24, 5); ctx.lineTo(12, 10); ctx.fill(); ctx.stroke();
        ctx.restore();
    },
    update() {
        if(gameState === "START") { this.y = 300 + Math.sin(frames*0.1)*15; return; }
        this.vel += this.gravity; this.y += this.vel;
        this.rot = Math.min(Math.PI/4, Math.max(-Math.PI/4, this.vel * 0.12));
        if(this.y + this.h >= canvas.height - 80) die();
    }
};

function die() {
    if(gameState === "OVER") return;
    gameState = "OVER"; shake = 25; flash = 1;
}

function loop() {
    ctx.save();
    // 1. Ekran Sarsıntısı (Shake)
    if(shake > 0) {
        ctx.translate(Math.random()*shake - shake/2, Math.random()*shake - shake/2);
        shake *= 0.85;
    }

    // 2. Dinamik Arka Plan & Hard Mode (25 Puandan Sonra)
    let hue = (score >= 25) ? 0 : 197; // Kırmızı veya Mavi gökyüzü
    ctx.fillStyle = `hsl(${hue}, 40%, ${score >= 25 ? 10 : 55}%)`;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // 3. Boru Mantığı (Hareketli Borular)
    if(gameState === "PLAYING" && frames % 90 === 0) {
        let gap = (score >= 25) ? 100 : 130;
        let pY = Math.random() * -250 - 50;
        pipes.push({x: canvas.width, y: pY, gap: gap, seed: Math.random() * 5, passed: false});
    }

    pipes.forEach((p, i) => {
        p.x -= gameSpeed;
        // Boru Hareketleri (Hard Mode)
        let move = (score >= 15) ? Math.sin(frames * 0.06 + p.seed) * 45 : 0;
        
        ctx.fillStyle = (score >= 25) ? "#550000" : "#73bf2e";
        ctx.strokeStyle = "black"; ctx.lineWidth = 3;
        
        // Üst Boru
        ctx.fillRect(p.x, p.y + move, 60, 400); ctx.strokeRect(p.x, p.y + move, 60, 400);
        // Alt Boru
        ctx.fillRect(p.x, p.y + move + 400 + p.gap, 60, 600); ctx.strokeRect(p.x, p.y + move + 400 + p.gap, 60, 600);
        
        // Hitbox Kontrolü
        if(bird.x + 28 > p.x && bird.x + 6 < p.x + 60) {
            if(bird.y + 6 < p.y + move + 400 || bird.y + 18 > p.y + move + 400 + p.gap) die();
        }
        if(!p.passed && p.x + 60 < bird.x) { 
            score++; p.passed = true; 
            gameSpeed += 0.04; 
            if(score % 10 === 0) shake = 15; // Her 10 puanda ekran sarsılır
        }
        if(p.x < -100) pipes.splice(i, 1);
    });

    bird.update(); bird.draw();

    // 4. Hard Mode Karanlık Efekti (Vignette)
    if(score >= 25) {
        let grad = ctx.createRadialGradient(bird.x + 15, bird.y + 10, 50, bird.x + 15, bird.y + 10, 250);
        grad.addColorStop(0, "rgba(0,0,0,0)");
        grad.addColorStop(1, "rgba(0,0,0,0.95)");
        ctx.fillStyle = grad;
        ctx.fillRect(0,0, canvas.width, canvas.height);
    }

    // Zemin
    ctx.fillStyle = "#ded895"; ctx.fillRect(0, canvas.height-80, canvas.width, 80);

    // UI
    ctx.textAlign = "center"; ctx.fillStyle = "white"; ctx.strokeStyle = "black"; ctx.lineWidth = 6;
    ctx.font = "60px Impact";
    ctx.strokeText(score, canvas.width/2, 100); ctx.fillText(score, canvas.width/2, 100);

    if(gameState === "OVER") {
        ctx.font = "40px Impact"; ctx.strokeText("OYUN BİTTİ", canvas.width/2, 280);
        ctx.fillText("OYUN BİTTİ", canvas.width/2, 280);
        ctx.font = "20px Impact"; ctx.fillText("TEKRAR DENEMEK İÇİN TIKLA", canvas.width/2, 330);
    }

    ctx.restore();
    if(flash > 0) { ctx.fillStyle = `rgba(255,255,255,${flash})`; ctx.fillRect(0,0,canvas.width,canvas.height); flash -= 0.1; }
    frames++; requestAnimationFrame(loop);
}

const input = () => {
    if(gameState === "START") gameState = "PLAYING";
    else if(gameState === "PLAYING") bird.vel = -bird.jump;
    else if(gameState === "OVER" && flash <= 0) {
        pipes = []; score = 0; bird.y = 300; bird.vel = 0; gameSpeed = 2.8; gameState = "PLAYING";
    }
};

canvas.addEventListener("mousedown", input);
window.addEventListener("keydown", (e) => { if(e.code === "Space") input(); });
loop();
</script>
</body>
</html>
